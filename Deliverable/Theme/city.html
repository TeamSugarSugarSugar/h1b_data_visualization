<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

    <title>H1b Data Visulization</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <!--external css-->
    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
        
    <!-- Custom styles for this template -->
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/style-responsive.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->



  </head>

  <body>

  <section id="container" >
      <!-- **********************************************************************************************************************************************************
      TOP BAR CONTENT & NOTIFICATIONS
      *********************************************************************************************************************************************************** -->
      <!--header start-->
      <header class="header black-bg">
              <div class="sidebar-toggle-box">
                  <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
              </div>
            <!--logo start-->
            <a href="index.html" class="logo"><b>H1b Visa Data Visulization</b></a>
            <!--logo end-->
          <script src="http://d3js.org/d3.v3.min.js"></script>
          <script type="text/javascript" src="./assets/data/h1bdata.js" charset="utf-8"></script>
          <style type="text/css">
              .x-axis path {
                  stroke:white;
                  fill:none;
              }
              .x-axis line {
                  fill: none;
                  stroke: none;
                  stroke-opacity:.8;
                  shape-rendering: crispEdges;
              }
              .bars rect {
                  fill:steelblue;
                  fill-opacity:.9;
              }
              .title {
                  font-size: 10px;
                  font-weight: bold;
              }
              #precise-value {
                  fill:white;
                  font-size: 11px;
              }
              .bar-svg text {
                  font-size: 14px;
              }
              .text {
                  font-size: 16px;
              }

              #title{
                  font-size: 14px;
              }

              #vis_container{
                  overflow: auto;
              }
              #barchart {
                  float:left;
                  width: 550px;
                  height: 500px;
              }
              #piechart {
                  float:left;
                  width: 650px;
                  height: 500px;
              }
              .labels{
                  font-size: 10px;
                  font-weight: bold;
              }
              svg {
                  width: 99%;
                  height: 99%;
              }
              path.slice{
                  stroke-width:2px;
              }

              polyline{
                  opacity: .3;
                  stroke: black;
                  stroke-width: 2px;
                  fill: none;
              }
          </style>
              </header>
      <!--header end-->
      
      <!-- **********************************************************************************************************************************************************
      MAIN SIDEBAR MENU
      *********************************************************************************************************************************************************** -->
      <!--sidebar start-->
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <!-- sidebar menu start-->
              <ul class="sidebar-menu" id="nav-accordion">
              
              	  <p class="centered"><a href="profile.html"><img src="assets/img/logo.png" class="img-circle" width="60"></a></p>
              	  <h5 class="centered">H1B Visa</h5>
              	  	
                  <li class="mt">
                      <a  href="general_info.html">
                          <i class="fa fa-dashboard"></i>
                          <span>General</span>
                      </a>
                  </li>

                  <li class="mt">
                      <a href="states.html">
                          <i class="fa fa-dashboard"></i>
                          <span>States</span>
                      </a>
                  </li>

                  <li class="mt">
                      <a href="industry.html">
                          <i class="fa fa-dashboard"></i>
                          <span>Industry</span>
                      </a>
                  </li>

                  <li class="mt">
                      <a class="active" href="city.html">
                          <i class="fa fa-dashboard"></i>
                          <span>City</span>
                      </a>
                  </li>

                  <!-- <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-desktop"></i>
                          <span>UI Elements</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="general.html">General</a></li>
                          <li><a  href="buttons.html">Buttons</a></li>
                          <li><a  href="panels.html">Panels</a></li>
                      </ul>
                  </li> -->

                  <!-- <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-cogs"></i>
                          <span>Components</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="calendar.html">Calendar</a></li>
                          <li><a  href="gallery.html">Gallery</a></li>
                          <li><a  href="todo_list.html">Todo List</a></li>
                      </ul>
                  </li> -->
                  <!-- <li class="sub-menu">
                      <a class="active" href="javascript:;" >
                          <i class="fa fa-book"></i>
                          <span>Extra Pages</span>
                      </a>
                      <ul class="sub">
                          <li class="active"><a  href="blank.html">Blank Page</a></li>
                          <li><a  href="login.html">Login</a></li>
                          <li><a  href="lock_screen.html">Lock Screen</a></li>
                      </ul>
                  </li> -->
                  <!-- <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-tasks"></i>
                          <span>Forms</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="form_component.html">Form Components</a></li>
                      </ul>
                  </li>
                  <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-th"></i>
                          <span>Data Tables</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="basic_table.html">Basic Table</a></li>
                          <li><a  href="responsive_table.html">Responsive Table</a></li>
                      </ul>
                  </li> -->
                  <!-- <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class=" fa fa-bar-chart-o"></i>
                          <span>Charts</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="morris.html">Morris</a></li>
                          <li><a  href="chartjs.html">Chartjs</a></li>
                      </ul>
                  </li> -->

              </ul>
              <!-- sidebar menu end-->
          </div>
      </aside>
      <!--sidebar end-->
      
      <!-- **********************************************************************************************************************************************************
      MAIN CONTENT
      *********************************************************************************************************************************************************** -->
      <!--main content start-->
      <section id="main-content">
          <section class="wrapper site-min-height">
          <h3><i class="fa fa-angle-right"></i> City Overview</h3>
              <p class="text"><br>&nbsp;&nbsp;&nbsp;&nbsp; Select the H1B visa application year to display:
                  <select onchange="render(this.options[this.selectedIndex].value)">
                      <option selected value="2010">2010</option>
                      <option value="2011">2011</option>
                      <option value="2012">2012</option>
                      <option value="2013">2013</option>
                      <option value="2014">2014</option>
                  </select>
              </p>
              <div id="vis_container"><div id="barchart"></div><div id="piechart"></div></div>
              <p class="text">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The data used in this visualization demonstration was retrieved on Sep 31, 2015 from United States Department of Labor Website (http://www.dol.gov/).
              </p>
              <body>
              <script type="text/javascript">


                  // filter here perform as the intermediate switch to remove old svg and replace a new one.
                  function filter(input){
                      var pointer = input;
                      d3.selectAll("svg").remove();
                      return pointer;
                  }

                  var file;

                  console.log("Version 1.0, November 20, 2015");

                  function render(input) {
                      var pointer = filter(input);
                      var file = raw_data.filter(function (d) {
                          return (d.year == pointer);
                      });
                      window.file = file;
                      var margin = {top: 50, bottom: 50, left: 140, right: 40};
//        var width2 = parseInt(d3.select('#base_svg').style('width'), 10);
                      var width = 500 - margin.left - margin.right;
                      var height = 500 - margin.top - margin.bottom;
                      var xScale = d3.scale.linear().range([0, width]);
                      var yScale = d3.scale.ordinal().rangeRoundBands([0, height], 1.8, 0);


                      var numTicks = 6;
                      var xAxis = d3.svg.axis().scale(xScale)
                              .orient("top")
                              .tickSize((-height))
                              .ticks(numTicks);

                      var svg = d3.select("#barchart").append("svg")
                              .attr("width", width + margin.left + margin.right)
                              .attr("height", height + margin.top + margin.bottom)
                              .attr("class", "bar-svg");

                      var barSvg = svg.append("g")
                              .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                              .attr("class", "bar-svg");

                      var x = barSvg.append("g")
                              .attr("class", "x-axis");


                      var xMin = 0;
                      xScale.domain([0, 30000]);
                      yScale.domain(file.map(function (d) {
                          return d.city;
                      }));

                      d3.select(".bar-svg").append("text")
                              .attr("x", margin.left)
                              .attr("y", (margin.top) / 2)
                              .attr("text-anchor", "start")
                              .text("Top 20 H1B visa application cities (break down by year)")
                              .attr("class", "title");


                      var groups = barSvg.append("g").attr("class", "labels")
                              .selectAll("text")
                              .data(file);


                      groups.enter().append("g").append("text").transition()
                              .attr("x", "0")
                              .attr("y", function (d) {
                                  return yScale(d.city);
                              })
                              .text(function (d) {
                                  return d.city;
                              })
                              .attr("text-anchor", "end")
                              .attr("font-size", "12px")
                              .attr("dy", "1.05em")
                              .attr("dx", "-.32em")
                              .attr("id", function (d) {
                                  return d.city;
                              });


                      var bars = barSvg.selectAll("rect").data(file);

                      bars.enter().append("rect")
                              .attr("class", "bars")
                              .attr("width", 0)
                              .attr("height", height / 20)
                              .attr("x", xScale(xMin))
                              .style("fill", "steelblue")
                              .style('fill-opacity', 0)
                              .attr("y", function (d) {
                                  return yScale(d.city);
                              })
                              .attr("id", function (d) {
                                  return d.city;
                              })
                              .append("svg:title").text(function (d) {
                          return "City: " + d.city + "\nTotal Application: " + d.case_count;
                      });


                      bars.transition().delay(100).duration(900)
                              .attr("width", function (d) {
                                  return xScale(d.case_count);
                              })
                              .attr("height", height / 20)
                              .style('fill-opacity', 1)
                              .transition();

                      bars
                              .on("mouseover", function () {
                                  d3.select(this).style("fill", "#ff9900");
                                  d3.select(this).style("font-weight", "bold");
                              })
                              .on("mouseout", function () {
                                  d3.select(this).style("fill", "steelblue");
                                  d3.select(this).style("font-weight", "normal");
                              })
                              .on("click", function (d) {
                                  change(getData(d.city));
                              })
                      ;


                      x.call(xAxis);
                      var grid = xScale.ticks(numTicks);
                      barSvg.append("g").attr("class", "grid")
                              .selectAll("line")
                              .data(grid, function (d) {
                                  return d;
                              })
                              .enter().append("line")
                              .attr("y1", 0)
                              .attr("y2", height + margin.bottom)
                              .attr("x1", function (d) {
                                  return xScale(d);
                              })
                              .attr("x2", function (d) {
                                  return xScale(d);
                              })
                              .attr("stroke", "white");

                      var labels = barSvg.append("g").attr("class", "labels")
                              .selectAll("text")
                              .data(file)
                              .enter()
                              .append("g");

                      labels.append("text")
                              .attr("x", function (d) {
                                  return xScale(d.case_count);
                              })
                              .attr("y", function (d) {
                                  return yScale(d.city);
                              })
                              .text(function (d) {
                                  return d.case_count;
                              })
                              .attr("text-anchor", "end")
                              .attr("dy", "1.22em")
                              .attr("dx", "-.05em")
                              .attr("id", "precise-value");



                      /*Pie Chart Part*/

                      var width2 = 500, height2 = 600, radius = Math.min(width2, height2) / 4;

                      var svg = d3.select("#piechart")
                              .attr("class", "pie-svg")
                              .append("svg")
                              .append("g");

                      svg.append("g")
                              .attr("class", "slices");
                      svg.append("g")
                              .attr("class", "labels");
                      svg.append("g")
                              .attr("class", "lines");

                      var pie = d3.layout.pie()
                              .sort(null)
                              .value(function(d) {
                                  return d.value;
                              });

                      var arc = d3.svg.arc()
                              .outerRadius(radius * 0.6)
                              .innerRadius(radius * 0.3);

                      var outerArc = d3.svg.arc()
                              .innerRadius(radius * 0.55)
                              .outerRadius(radius * 0.55);

                      svg.attr("transform", "translate(" + width2 / 2 + "," + height2 / 2.5 + ")");


                      var color = d3.scale.ordinal()
                              .domain(["no1", "no2", "no3", "no4", "no5", "no6", "no7", "no8", "no9", "no10"])
                              .range(["#FF1212","#FF5912", "#FF6F12", "#FF8D12", "#FFD112", "#FFE612","F0FC12","#BEF311","#7CE610","#0EC625"]);

                      function getData (input){
                          var city = input;
                          d3.select("#title").remove();
                          svg.append("text")
                                  .attr("x", -235)
                                  .attr("y", -187)
                                  .attr("text-anchor", "start")
                                  .text("Top 10 Industries with most H1b Visa applications in the city of "+ city)
                                  .attr("class", "title")
                                  .attr("id","title");


                          var citylist = top_city_nacis.filter(function (d) {
                              return (d.city == city);});
                          var key =[];
                          for (i = 0; i < citylist.length; i++) {
                              key[i] = citylist[i]["industry"];
                          }
                          var newkey=key;
                          var labels = key;
                          var datalist = [];
                          for (i = 0; i < citylist.length; i++) {
                              datalist[i] = citylist[i]["count"];
                          }
                          return labels.map(function (label, j) {
                              var onecount = (datalist[j]/1000);
                              j+=1;
                              return {label: label, value:onecount}
                          })
                      }

                      var firstcity = file[0]["city"];
                      change(getData(firstcity));

                      var key;

                      function change(data) {

                          /* ------- PIE SLICES -------*/
                          var slice = svg.select(".slices").selectAll("path.slice")
                                  .data(pie(data), key);

                          slice.enter()
                                  .insert("path")
                                  .attr("opacity",0)
                                  .style("fill", function(d) { return color(d.data.label); })
                                  .attr("class", "slice")
                                  .append("svg:title").text(function (d) {
                              return "Industry: " + d.data.label + "\nNumber of Companies: " + (d.data.value*1000);
                          });

                          slice
                                  .transition().delay(100).duration(800)
                                  .attr("opacity",1)
                                  .attrTween("d", function(d) {
                                      this._current = this._current || d;
                                      var interpolate = d3.interpolate(this._current, d);
                                      this._current = interpolate(0);
                                      return function(t) {
                                          return arc(interpolate(t));
                                      };
                                  })
                                  .select("title").text(function (d) {
                              return "Industry: " + d.data.label + "\nNumber of Companies: " + (d.data.value*1000);
                          });

                          slice.exit()
                                  .remove();



                          /* ------- TEXT LABELS -------*/

                          var text = svg.select(".labels").selectAll("text")
                                  .data(pie(data), key);

                          text.enter()
                                  .append("text")
                                  .attr("dy", ".35em")
                                  .text(function(d) {
                                      return d.data.label;
                                  });

                          function midAngle(d){
                              return d.startAngle + (d.endAngle - d.startAngle)/2;
                          }

                          text.transition().delay(100).duration(1000)
                                  .attrTween("transform", function(d) {
                                      this._current = this._current || d;
                                      var interpolate = d3.interpolate(this._current, d);
                                      this._current = interpolate(0);
                                      return function(t) {
                                          var d2 = interpolate(t);
                                          var pos = outerArc.centroid(d2);
                                          pos[0] = radius * (midAngle(d2) < Math.PI ? 0.55 : -0.55);
                                          return "translate("+ pos +")";
                                      };
                                  })
                                  .styleTween("text-anchor", function(d){
                                      this._current = this._current || d;
                                      var interpolate = d3.interpolate(this._current, d);
                                      this._current = interpolate(0);
                                      return function(t) {
                                          var d2 = interpolate(t);
                                          return midAngle(d2) < Math.PI ? "start":"end";
                                      };
                                  })
                                  .text(function(d) {
                                      return d.data.label;
                                  });
                          ;

                          text.exit()
                                  .remove();

                          /* ------- SLICE TO TEXT POLYLINES -------*/

                          var polyline = svg.select(".lines").selectAll("polyline")
                                  .data(pie(data), key);

                          polyline.enter()
                                  .append("polyline");

                          polyline.transition().duration(1000)
                                  .attrTween("points", function(d){
                                      this._current = this._current || d;
                                      var interpolate = d3.interpolate(this._current, d);
                                      this._current = interpolate(0);
                                      return function(t) {
                                          var d2 = interpolate(t);
                                          var pos = outerArc.centroid(d2);
                                          pos[0] = radius * 0.53 * (midAngle(d2) < Math.PI ? 1 : -1);
                                          return [arc.centroid(d2), outerArc.centroid(d2), pos];
                                      };
                                  });

                          polyline.exit()
                                  .remove();



                      }





                  }

                  render("2010");





              </script></body>
		</section><! --/wrapper -->
      </section><!-- /MAIN CONTENT -->

      <!--main content end-->
      <!--footer start-->
      <footer class="site-footer">
          <div class="text-center">
              2015 - INLS690 Project by (Wanchun Zhao, Zhenwei Wang, Wei Hu, Huiying Ma)
              <a href="blank.html#" class="go-top">
                  <i class="fa fa-angle-up"></i>
              </a>
          </div>
      </footer>
      <!--footer end-->
  </section>

    <!-- js placed at the end of the document so the pages load faster -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/jquery-ui-1.9.2.custom.min.js"></script>
    <script src="assets/js/jquery.ui.touch-punch.min.js"></script>
    <script class="include" type="text/javascript" src="assets/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="assets/js/jquery.scrollTo.min.js"></script>
    <script src="assets/js/jquery.nicescroll.js" type="text/javascript"></script>


    <!--common script for all pages-->
    <script src="assets/js/common-scripts.js"></script>

    <!--script for this page-->

 

  </body>
</html>
